<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Path Finder</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-2.0.3.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>

  <script>
  $(function() {
    $( "#start" ).datepicker();
  });
  $(function() {
    $( "#end" ).datepicker();
  });
  $(function() {
    $( "#state" ).selectmenu();
  });
  $(function() {
    $( "#category" ).selectmenu();
  });
  $(function() {
    $( "#city").selectmenu();
  });
  </script>

  <style>
   fieldset {
     border: 0;
   }
   label {
     display: block;
     margin: 30px 0 0 0;
   }
   select {
     width: 150px;
   }
   .overflow {
     height: 200px;
   }

   .axis path,
   .axis line {
     fill: none;
     stroke: #000;
     shape-rendering: crispEdges;
   }

   .x.axis path {
     display: none;
   }

   .line {
     fill: none;
     stroke: steelblue;
     stroke-width: 1.5px;
   }
 </style>
</head>

<body>

<!-- not yet
<p>Start Date: <input type="text" id="start" onchange=newStartDate()></p>
<p>End Date: <input type="text" id="end" onchange=newEndDate()></p>
-->

<label for="city">Select a city</label>
<select name="city" id="city"></select>

<label for="state">Select a state</label>
<select name="state" id="state"></select>

<label for="category">Select a category</label>
<select name="category" id="category"></select>

<button type="button" class="home">Refresh Chart</button>

<script>
// first and foremost
var host = '52.23.157.248';

//----------------------- viz components -------------------------

//----------------------- viz components -------------------------

//----------------------- initialization -------------------------
// populate state, city, category dropdowns
// TODO: you can see there are all kinds crap in the data: cleaning is a huge deal
initialize();


//----------------------- initialization -------------------------

//----------------------- event handlers -------------------------
function newStartDate() {
  if ($('#end').val() == "" || $('#state').val() == "") {
    // if end is null, do nothing
    return;
  }
  //alert($('#start').val())
  refreshData();
}

function newEndDate() {
  if ($('#start').val() == "" || $('#state').val() == "") {
    // if start is null, do nothing
    return;
  }
  //alert($('#end').val())
  refreshData();
}

$('#state').on('selectmenuchange', function() {
  if ($('#start').val() == "" || $('#end').val() == "") {
    // if start or end is null, do nothing
    return;
  }
  //alert($('#state').val());
  refreshData();
});

$('#category').on('selectmenuchange', function() {
  if (plot_data == null || plot_data.length == 0) {
    console.warn('No data to plot!')
    return;
  }
  //alert($('#state').val());
  refreshChart();
});

$('#city').on('selectmenuchange', function() {
  if (plot_data == null || plot_data.length == 0) {
    console.warn('No data to plot!')
    return;
  }
  //alert($('#state').val());
  refreshChart();
});

$('button.home').click(function(){

});
//----------------------- event handlers -------------------------

//----------------------- biz logic -------------------------
var plot_data, query_data;
// send HQL to hive - string HQL input
function initialize() {
  var HQL = 'select distinct state from e_segments order by state';
  console.log('Start query states: ' + HQL)
  $.ajax({
    type: "GET",
    url: "http://" + host + ":8330/cgi-bin/HQL_SELECT.py",
    data: { hql: HQL }
  }).done(function(output) {
     // get return
     states = output;
     console.log('State HQL completed with ' + output.length + ' rows.');
     getCategories();
  });
}

function getCategories() {
  var HQL = 'select distinct climb_category from e_segments order by climb_category';
  console.log('Start query categories: ' + HQL)
  $.ajax({
    type: "GET",
    url: "http://" + host + ":8330/cgi-bin/HQL_SELECT.py",
    data: { hql: HQL }
  }).done(function(output) {
     // get return
     categories = output;
     console.log('Category HQL completed with ' + output.length + ' rows.');
     getCities();
  });
}

function getCities() {
  var HQL = "select distinct concat(city,', ',state) as c from e_segments order by c";
  console.log('Start query cities: ' + HQL)
  $.ajax({
    type: "GET",
    url: "http://" + host + ":8330/cgi-bin/HQL_SELECT.py",
    data: { hql: HQL }
  }).done(function(output) {
     // get return
     cities = output;
     console.log('City HQL completed with ' + output.length + ' rows.');
     populateDropdowns()
  });
}

function populateDropdowns() {
  // clear first
  $('#state').empty();
  $('#city').empty();
  $('#category').empty();
  // populate
  $.each(states, function(i, v) {
    $('#state')
      .append($("<option></option>")
      .attr('value', v.row.trim())
      .text(v.row.trim()));
  });
  $.each(cities, function(i, v) {
    $('#city')
      .append($("<option></option>")
      .attr('value', v.row.trim())
      .text(v.row.trim()));
  });
  $.each(categories, function(i, v) {
    $('#category')
      .append($("<option></option>")
      .attr('value', v.row.trim())
      .text(v.row.trim()));
  });
  // refresh
  $('#state').selectmenu('refresh');
  $('#city').selectmenu('refresh');
  $('#category').selectmenu('refresh');
}

function refreshData() {

}

function refreshChart() {

}
//----------------------- biz logic -------------------------
</script>

</body>
</html>
